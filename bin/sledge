#!/usr/bin/env lua

-- This is pretty simple for now (just a stub)

require 'redis'

local redis = Redis.connect('127.0.0.1', 6379)

local total_hits_hot = redis:get('sledge:counter:HOT') or 0
local total_hits_warm = redis:get('sledge:counter:WARM') or 0
local total_hits_subzero = redis:get('sledge:counter:SUBZERO') or 0
local info = redis:info()
local dbsize = redis:dbsize()

function total_hits()
    return total_hits_hot + total_hits_warm + total_hits_subzero
end

function round(val, decimal)
    if (decimal) then
        return math.floor( (val * 10^decimal) + 0.5) / (10^decimal)
    else
        return math.floor(val+0.5)
    end
end


print("\nsledge (ledge stats) v0.1")
print("==========================")
print("Total requests       " .. total_hits())
print(" HOT                 " .. total_hits_hot)
print(" WARM                " .. total_hits_warm)
print(" SUBZERO             " .. total_hits_subzero)
print("Hit rate             " .. tostring(round(total_hits_hot / total_hits() * 100))..'%')
print("--------------------------")
print("Number of items      " .. dbsize)
print("Memory usage         " .. info['used_memory_human'])
print("Peak memory usage    " .. info['used_memory_peak_human'])
print("Expired items        " .. info['expired_keys'])
print("Evictions            " .. info['evicted_keys'])
print("--------------------------")
print(" ")
